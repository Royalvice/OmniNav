# OmniNav é¡¹ç›®è¿›å±•ä¸æŠ€æœ¯æ‰‹å†Œ (Walkthrough)

æœ¬æ–‡æ¡£è®°å½• OmniNav ä»¿çœŸå¹³å°çš„åŠŸèƒ½æ¼”è¿›ã€é‡å¤§é‡æ„å½•ä»¥åŠæŠ€æœ¯å®ç°æ–¹æ¡ˆã€‚

---

## ğŸš€ æœ€æ–°è¿›å±•ï¼šV0.1.0 æ¶æ„é‡æ„ (2026-02)

æˆ‘ä»¬å®Œæˆäº†ä¸€æ¬¡ä»åº•å±‚åˆ°é¡¶å±‚çš„å…¨é‡æ¶æ„é‡æ„ï¼Œç›®æ ‡æ˜¯å°† OmniNav ä»ä¸€ä¸ªç®€å•çš„ Demo é›†åˆæ¼”è¿›ä¸ºå…·æœ‰**å•†ä¸šçº§ç¨³å®šæ€§**å’Œ**é«˜åº¦å¯æ‰©å±•æ€§**çš„ä»¿çœŸç ”ç©¶å¹³å°ã€‚

### 1. æ ¸å¿ƒæ”¹è¿›ï¼šä»è¿‡ç¨‹å¼åˆ°ç¼–æ’å¼
é‡æ„å‰ï¼Œä»¿çœŸé€»è¾‘æ•£è½åœ¨ `OmniNavEnv` ä¸­ï¼Œå­˜åœ¨ä¸¥é‡çš„ç»„ä»¶è€¦åˆã€‚
é‡æ„åï¼Œæˆ‘ä»¬å¼•å…¥äº† `SimulationRuntime` ä½œä¸ºæ ¸å¿ƒç¼–æ’å™¨ï¼Œé€šè¿‡ **Registry (æ³¨å†Œå™¨)** ç³»ç»ŸåŠ¨æ€æ„å»ºç»„ä»¶ã€‚

#### é‡æ„äº®ç‚¹ï¼š
- **Registry ç³»ç»Ÿ**: æ‰€æœ‰ Robot, Sensor, Locomotion, Algorithm, Task å‡é€šè¿‡æ³¨å†Œå™¨å‘ç°ã€‚
- **Lifecycle çŠ¶æ€æœº**: æ¯ä¸ªç»„ä»¶æ‹¥æœ‰ `CREATED -> SPAWNED -> BUILT -> READY` çš„æ˜ç¡®çŠ¶æ€æµè½¬ã€‚
- **è§£è€¦çš„ä¼ æ„Ÿå™¨ç³»ç»Ÿ**: ä¼ æ„Ÿå™¨ä¸å†ç¡¬ç¼–ç åœ¨æœºå™¨äººä¸­ï¼Œè€Œæ˜¯é€šè¿‡é…ç½®åŠ¨æ€æŒ‚è½½ã€‚
- **æ ‡å‡†åŒ–æ•°æ®æµ**: æ‰€æœ‰è§‚æµ‹å’ŒåŠ¨ä½œç»Ÿä¸€ä½¿ç”¨ `TypedDict`ï¼Œä¸”å¼ºåˆ¶æ‰§è¡Œ **Batch-First** ç»´åº¦ã€‚

### 2. å·¡æ£€ä»»åŠ¡è‡ªåŠ¨åŒ– (Inspection Automation)
åŸºäºæ–°æ¶æ„ï¼Œæˆ‘ä»¬å®ç°äº†ç¬¬ä¸€ä¸ªå¤æ‚çš„å…¨é“¾è·¯ä»»åŠ¡ï¼š**å°é—­ç¯å¢ƒè‡ªåŠ¨å·¡æ£€**ã€‚

- **ç®—æ³•å±‚**: å®ç°äº† `InspectionPipeline`ï¼Œé›†æˆå…¨å±€è§„åˆ’ä¸ DWA é¿éšœã€‚
- **è¯„æµ‹å±‚**: å®ç°äº†è¦†ç›–ç‡è®¡ç®—å’Œ SPL è·¯å¾„æŒ‡æ ‡ç›‘æµ‹ã€‚
- **é…ç½®ç³»ç»Ÿ**: å…¨é¢è¿ç§»è‡³ **Hydra**ï¼Œæ”¯æŒå‘½ä»¤è¡Œå¿«é€Ÿè¦†ç›–ï¼ˆå¦‚ï¼š`robot=go2w locomotion=kinematic_gait`ï¼‰ã€‚

#### è¿è¡Œæ–°å·¡æ£€ç¤ºä¾‹ï¼š
```bash
python examples/run_inspection.py
```

---

## ğŸ› ï¸ æŠ€æœ¯æ·±åº¦ï¼šKinematic Controller é‡æ„ä¸æ€§èƒ½ä¼˜åŒ–

> [!NOTE]
> è¿™æ˜¯æœ¬é¡¹ç›®åœ¨ V0.1 å¼€å‘åˆæœŸæœ€é‡è¦çš„æŠ€æœ¯çªç ´ï¼Œå°†æ­¥æ€ä»¿çœŸæ•ˆç‡æå‡äº†è¿‘ 100 å€ã€‚

### é—®é¢˜è¯Šæ–­
åŸæœ‰çš„ Go2 è¿åŠ¨æ§åˆ¶å™¨æ¯å¸§è°ƒç”¨ IK æ±‚è§£å™¨ï¼Œå¯¼è‡´ 10Hz çš„ä¸¥é‡å¡é¡¿å’Œç‰©ç†ä¸ç¨³å®šæ€§ã€‚

### è§£å†³æ–¹æ¡ˆï¼šé¢„çƒ˜ç„™åŠ¨ç”»ç³»ç»Ÿ (Pre-Baked)
å‚è€ƒæ¸¸æˆè¡Œä¸šæœ€ä½³å®è·µï¼ˆå¦‚ Naughty Dog, Unreal Engineï¼‰ï¼š
1. **åˆå§‹åŒ–æ¨æ–­**: åœ¨ `reset()` æ—¶ä¸€æ¬¡æ€§é¢„è®¡ç®— 32 å¸§æ­¥æ€å…³é”®å¸§ã€‚
2. **è¿è¡Œæ—¶æŸ¥æ‰¾**: ä½¿ç”¨å¿«é€Ÿæ’å€¼æŸ¥æ‰¾ï¼ˆCubic Interpolationï¼‰ã€‚
3. **ç‰©ç†æ„ŸçŸ¥**: ä½¿ç”¨ PD æ§åˆ¶å™¨ (`control_dofs_position`) ä»£æ›¿ç¡¬è®¾ç½®ä½ç½®ã€‚

**æ€§èƒ½å¯¹æ¯”ï¼š**
- **åŸç”Ÿ IK**: 5-10ms/å¸§ (100 FPS ç³»ç»Ÿä¸‹æ— æ³•ç»´æŒ)
- **é¢„çƒ˜ç„™æ’å€¼**: 0.1ms/å¸§ (è½»æ¾æ”¯æŒ 100+ ç¯å¢ƒå¹¶è¡Œ)

---

## ğŸ“Š æˆæœæ¦‚è§ˆ (v0.1.0)

| æ¨¡å—           | é‡æ„æˆæœ                                          | çŠ¶æ€   |
| -------------- | ------------------------------------------------- | ------ |
| **Core**       | `SimulationRuntime`, `Registry`, `LifecycleMixin` | âœ… ç¨³å®š |
| **Robot**      | Go2/Go2w ç»Ÿä¸€æ¥å£ï¼Œæ”¯æŒ Batch è°ƒç”¨                | âœ… å®Œæˆ |
| **Sensor**     | æ”¯æŒç›¸æœºã€æ¿€å…‰é›·è¾¾æ‰¹é‡æ•°æ®é‡‡é›†                    | âœ… å®Œæˆ |
| **Locomotion** | é¢„çƒ˜ç„™åŠ¨åŠ›å­¦æ­¥æ€ï¼Œ0.1ms å»¶è¿Ÿ                      | âœ… å“è¶Š |
| **Interface**  | Gym-compatible Wrapper, ROS2 Bridge               | âœ… å¯ç”¨ |
| **Test**       | ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•è¦†ç›–                                | âœ… é€šè¿‡ |

---

## ğŸ“‚ å†å²è¿è¡Œç¤ºä¾‹ (Legacy Demos)

```bash
# Go2 å››è¶³æœºå™¨äººé¥æ§ (æ­¥æ€ä¼˜åŒ–å±•ç¤º)
python examples/01_teleop_go2.py

# Go2w è½®å¼å¯¼èˆª (ç‚¹åˆ°ç‚¹çŠ¶æ€æœºæ¼”ç¤º)
python examples/05_waypoint_navigation.py

# æ¿€å…‰é›·è¾¾å¯è§†åŒ–
python examples/03_lidar_visualization.py
```

---

## æ€»ç»“
é€šè¿‡æœ¬æ¬¡é‡æ„ï¼ŒOmniNav å·²ç»å…·å¤‡äº†ä½œä¸ºç§‘ç ”å¹³å°çš„åŸºç¡€å®åŠ›ã€‚åç»­æˆ‘ä»¬å°†åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ¢ç´¢ VLA (Vision-Language-Action) æ¨¡å‹åœ¨å¤§è§„æ¨¡ä»¿çœŸç¯å¢ƒä¸­çš„æ³›åŒ–æ€§èƒ½ã€‚

---

## ROS2 / Nav2 å¯¹æ¥è¡¥å…… (2026-02-19)

æˆ‘ä»¬å°† ROS2 Bridge ä»â€œå•æ–‡ä»¶é€»è¾‘â€å‡çº§ä¸ºâ€œå¥‘çº¦é©±åŠ¨ + ç»„ä»¶åŒ–â€æ¨¡å¼ï¼Œå…³é”®å˜åŒ–å¦‚ä¸‹ï¼š

1. æ–°å¢é…ç½®å¥‘çº¦ï¼š`control_source/profile/topics/frames/publish/qos`
2. é»˜è®¤æ§åˆ¶æºå›ºå®šä¸º `python`ï¼Œå¯åˆ‡æ¢ `ros2` ä»¥è®¢é˜… `/cmd_vel`
3. profile åŒ–å‘å¸ƒç­–ç•¥ï¼š
   - `all_off`: é»˜è®¤ä¸å‘å¸ƒ ROS2 topic
   - `nav2_minimal` / `nav2_full`: å‘å¸ƒ `clock/tf/tf_static/odom/scan`
   - `rviz_sensors`: åœ¨ `nav2_full` åŸºç¡€ä¸Šå¢åŠ  `rgb/depth image + camera_info`
4. å¢åŠ å‘½ä»¤è¶…æ—¶ä¿æŠ¤ï¼š`cmd_vel_timeout_sec`
5. examples è¿ç§»ä¸º ROS2 install-space åŒ…ï¼š`examples/ros2/omninav_ros2_examples`

å¯¹æ¥è¾¹ç•Œæ˜ç¡®ä¸ºï¼š
1. OmniNav è´Ÿè´£ä»¿çœŸæ•°æ®ä¸æ§åˆ¶æ¡¥æ¥
2. Nav2 è´Ÿè´£è§„åˆ’ä¸æ§åˆ¶
3. AMCL è´Ÿè´£å®šä½ï¼ˆ`map->odom`ï¼‰
4. map_server è´Ÿè´£ `/map`

---

## Examples å·¥ç¨‹åŒ–é‡æ„è¡¥å…… (2026-02-19)

1. åˆ é™¤ç»Ÿä¸€ demo runnerï¼Œæ¢å¤ä¸ºæ¯ä¸ª `examples/*.py` ä¿ç•™è‡ªèº«å®ä¾‹åŒ–ä¸ä¸šåŠ¡é€»è¾‘
2. ç¤ºä¾‹ä»é€šè¿‡ `configs/demo/*.yaml` ç»„åˆæ ‡å‡†æ¨¡å—é…ç½®ï¼ˆrobot/sensor/locomotion/algorithm/task/sceneï¼‰
3. æ–°å¢ç»Ÿä¸€æµ‹è¯•é™è½½å‚æ•° `--smoke-fast`ï¼Œç”¨äº `tests/examples/test_examples_smoke.py` çš„å…¨é‡é»˜è®¤æ‰§è¡Œæé€Ÿ
4. ROS2 ç¤ºä¾‹ä»¥ `ros2 run/launch` ä¸ºä¸»ï¼Œä¸å†ä½¿ç”¨å•æ–‡ä»¶ `examples/06_ros2_nav2_bridge.py`

---

## ROS2 Bridge å¯é æ€§ä¿®å¤ (2026-02-20)

ä¿®å¤äº† RViz å¯åŠ¨åä¼ æ„Ÿå™¨æ•°æ®ä¸å¯è§ã€éœ€è¦å¤–éƒ¨å‘½ä»¤è§¦å‘æ‰åˆ·æ–°çš„é—®é¢˜ã€‚æ ¹å› æœ‰äºŒï¼š

### 1. Static TF depth=1 æ‰¹é‡ä¸¢å¤±
`/tf_static` çš„ QoS ä¸º `keep_last, depth=1, transient_local`ï¼Œä½†ä¹‹å‰å¯¹
lidar/rgb_camera/depth_camera ä¸‰ä¸ª static TF åˆ†åˆ«è°ƒç”¨ `publish_static()`ï¼Œ
æ¯æ¬¡å‘ä¸€æ¡ç‹¬ç«‹ `TFMessage`ã€‚ç”±äº depth=1ï¼Œåªæœ‰æœ€åä¸€æ¡è¢«ä¿ç•™ç»™è¿Ÿåˆ°è®¢é˜…è€…ï¼Œ
å¯¼è‡´ `lidar_frame` å’Œ `camera_rgb_frame` å¯¹ RViz æ°¸è¿œä¸å¯è§ã€‚

**ä¿®å¤**ï¼š`TfPublisher.publish_static_batch()` å°†æ‰€æœ‰é™æ€å˜æ¢æ‰“åŒ…åˆ°å•æ¡
`TFMessage` ä¸­å‘å¸ƒï¼Œdepth=1 ä¹Ÿèƒ½å®Œæ•´ä¿ç•™å…¨éƒ¨å˜æ¢ã€‚

### 2. WSL2 ä¸Š DDS å‘ç°ç«æ€
OmniNav èŠ‚ç‚¹åœ¨ `setup()` åç«‹å³è¿›å…¥é«˜é¢‘ä»¿çœŸå¾ªç¯ï¼ˆspin_once timeout=0ï¼‰ï¼Œ
åœ¨ WSL2 å¤šæ’­å—é™çš„ç¯å¢ƒä¸‹ï¼ŒDDS endpoint å‘ç°æ¥ä¸åŠå®Œæˆï¼ŒRViz æ— æ³•åŒ¹é…åˆ°
publisherã€‚

**ä¿®å¤**ï¼š
- `setup()` åå¢åŠ å¯é…ç½®çš„ warmup æœŸï¼ˆé»˜è®¤ 2sï¼‰ï¼ŒæŒç»­å‘å¸ƒ `/clock` +
  static TF å¹¶ spinï¼Œè®© DDS å……åˆ†å®Œæˆå‘ç°ã€‚
- ä¸»å¾ªç¯ `spin_once` æ”¹ä¸º `timeout_sec=0.001`ï¼ˆå¯é…ç½®ï¼‰ã€‚
- å‰ 50 æ­¥ï¼ˆ`static_tf_republish_steps`ï¼‰æŒç»­é‡å‘ static TFï¼Œä½œä¸º
  åŒä¿é™©åº”å¯¹æç«¯å»¶è¿Ÿåœºæ™¯ã€‚

### æ–°å¢é…ç½®é¡¹
```yaml
ros2:
  spin_timeout_sec: 0.001        # spin_once æœ€å° timeout
  warmup_sec: 2.0                # DDS å‘ç°é¢„çƒ­æ—¶é•¿
  static_tf_republish_steps: 50  # å‰ N æ­¥é‡å‘ static TF
```
